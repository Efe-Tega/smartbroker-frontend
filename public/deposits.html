<!DOCTYPE html>
<html lang="en" class="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Deposits - CryptoBroker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              dark: {
                "bg-primary": "#1a1b1e",
                "bg-secondary": "#2c2e33",
                "text-primary": "#e4e6ea",
                "text-secondary": "#9ca3af",
              },
            },
          },
        },
      };
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../src/styles/main.css" />
  </head>
  <body
    class="bg-gray-50 dark:bg-dark-bg-primary dark:text-dark-text-primary transition-colors duration-200"
  >
    <!-- Navigation -->
    <nav
      class="bg-white dark:bg-dark-bg-secondary shadow-lg fixed top-0 left-0 right-0 z-40 transition-colors duration-200"
    >
      <div class="max-w-7xl mx-auto px-4">
        <div class="flex justify-between items-center h-16">
          <div class="flex items-center">
            <button
              id="menuBtn"
              class="text-gray-600 dark:text-dark-text-primary hover:text-blue-600 dark:hover:text-blue-400 inline-flex items-center justify-center p-2 rounded-md lg:hidden"
            >
              <i class="fas fa-bars text-xl"></i>
            </button>
            <a href="/" class="flex items-center ml-2 lg:ml-0">
              <span class="text-2xl font-bold text-blue-600">CryptoBroker</span>
            </a>
          </div>

          <!-- Add dark mode toggle for mobile -->
          <div class="flex items-center space-x-4 lg:hidden">
            <button
              id="darkModeToggleMobile"
              class="text-gray-600 dark:text-dark-text-primary hover:text-blue-600 dark:hover:text-blue-400 p-2"
            >
              <i class="fas fa-moon dark:hidden text-xl"></i>
              <i class="fas fa-sun hidden dark:inline text-xl"></i>
            </button>
          </div>

          <div class="hidden lg:flex items-center space-x-8">
            <!-- Add dark mode toggle for desktop -->
            <button
              id="darkModeToggle"
              class="text-gray-600 dark:text-dark-text-primary hover:text-blue-600 dark:hover:text-blue-400"
            >
              <i class="fas fa-moon dark:hidden"></i>
              <i class="fas fa-sun hidden dark:inline"></i>
            </button>
            <a
              href="#"
              class="text-gray-600 dark:text-dark-text-primary hover:text-blue-600 dark:hover:text-blue-400"
            >
              <i class="fas fa-bell"></i>
              <span class="ml-1">Notifications</span>
            </a>
            <div class="relative">
              <button
                class="flex items-center text-gray-600 dark:text-dark-text-primary hover:text-blue-600 dark:hover:text-blue-400"
              >
                <img
                  src="https://ui-avatars.com/api/?name=John+Doe"
                  alt="Profile"
                  class="h-8 w-8 rounded-full"
                />
                <span class="ml-2">John Doe</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <div class="flex pt-16">
      <!-- Sidebar -->
      <div
        id="sidebar"
        class="w-64 bg-white dark:bg-dark-bg-secondary h-screen shadow-lg fixed left-0 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-30"
      >
        <div class="p-4">
          <nav class="space-y-2">
            <a
              href="/dashboard.html"
              class="flex items-center p-3 text-gray-600 dark:text-dark-text-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg"
            >
              <i class="fas fa-chart-line w-6"></i>
              <span>Dashboard</span>
            </a>
            <a
              href="/deposits.html"
              class="flex items-center p-3 text-blue-600 bg-blue-50 dark:bg-blue-900/20 rounded-lg"
            >
              <i class="fas fa-wallet w-6"></i>
              <span>Deposits</span>
            </a>
            <a
              href="/investments.html"
              class="flex items-center p-3 text-gray-600 dark:text-dark-text-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg"
            >
              <i class="fas fa-coins w-6"></i>
              <span>Investments</span>
            </a>
            <a
              href="/history.html"
              class="flex items-center p-3 text-gray-600 dark:text-dark-text-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg"
            >
              <i class="fas fa-history w-6"></i>
              <span>History</span>
            </a>
            <a
              href="/settings.html"
              class="flex items-center p-3 text-gray-600 dark:text-dark-text-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg"
            >
              <i class="fas fa-cog w-6"></i>
              <span>Settings</span>
            </a>
          </nav>
        </div>
      </div>

      <!-- Overlay -->
      <div
        id="overlay"
        class="fixed inset-0 bg-black opacity-50 z-20 hidden lg:hidden"
      ></div>

      <!-- Main Content -->
      <div class="w-full lg:ml-64 p-8">
        <!-- Page Header -->
        <div class="mb-8">
          <h1
            class="text-2xl font-bold text-gray-800 dark:text-dark-text-primary"
          >
            Deposit Funds
          </h1>
          <p class="text-gray-600 dark:text-dark-text-secondary mt-1">
            Add funds to your account using cryptocurrency
          </p>
        </div>

        <!-- Deposit Methods -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
          <!-- Quick Deposit Card -->
          <div class="bg-white dark:bg-dark-bg-secondary rounded-lg shadow p-6">
            <h2
              class="text-lg font-semibold text-gray-900 dark:text-dark-text-primary mb-4"
            >
              Quick Deposit
            </h2>
            <div class="space-y-4">
              <div>
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-dark-text-primary mb-2"
                  >Select Cryptocurrency</label
                >
                <select
                  class="w-full border border-gray-300 dark:border-gray-600 dark:bg-dark-bg-primary dark:text-dark-text-primary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="btc">Bitcoin (BTC)</option>
                  <option value="eth">Ethereum (ETH)</option>
                  <option value="usdt">Tether (USDT)</option>
                  <option value="bnb">Binance Coin (BNB)</option>
                </select>
              </div>
              <div>
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-dark-text-primary mb-2"
                  >Amount (USD)</label
                >
                <input
                  type="number"
                  id="usdAmount"
                  min="100"
                  step="100"
                  placeholder="Enter amount"
                  class="w-full border border-gray-300 dark:border-gray-600 dark:bg-dark-bg-primary dark:text-dark-text-primary rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
                <p
                  class="text-sm text-gray-500 dark:text-dark-text-secondary mt-1"
                >
                  Minimum deposit: $100
                </p>
              </div>
              <div>
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-dark-text-primary mb-2"
                  >Equivalent Amount in Crypto</label
                >
                <div class="relative">
                  <input
                    type="text"
                    id="cryptoAmount"
                    readonly
                    class="w-full border border-gray-300 dark:border-gray-600 dark:bg-dark-bg-primary dark:text-dark-text-primary rounded-lg px-3 py-2 bg-gray-50 dark:bg-dark-bg-primary focus:outline-none"
                  />
                  <div
                    class="absolute inset-y-0 right-0 flex items-center pr-3"
                  >
                    <span
                      id="cryptoSymbol"
                      class="text-gray-500 dark:text-dark-text-secondary"
                    ></span>
                  </div>
                </div>
              </div>
              <button
                class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors"
              >
                Generate Deposit Address
              </button>
            </div>
          </div>

          <!-- Deposit Instructions -->
          <div class="bg-white dark:bg-dark-bg-secondary rounded-lg shadow p-6">
            <h2
              class="text-lg font-semibold text-gray-900 dark:text-dark-text-primary mb-4"
            >
              How to Deposit
            </h2>
            <div class="space-y-4">
              <div class="flex items-start">
                <div
                  class="flex-shrink-0 w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center text-blue-600"
                >
                  1
                </div>
                <div class="ml-4">
                  <h3
                    class="text-sm font-medium text-gray-900 dark:text-dark-text-primary"
                  >
                    Select Currency
                  </h3>
                  <p
                    class="text-sm text-gray-500 dark:text-dark-text-secondary"
                  >
                    Choose your preferred cryptocurrency for deposit
                  </p>
                </div>
              </div>
              <div class="flex items-start">
                <div
                  class="flex-shrink-0 w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center text-blue-600"
                >
                  2
                </div>
                <div class="ml-4">
                  <h3
                    class="text-sm font-medium text-gray-900 dark:text-dark-text-primary"
                  >
                    Enter Amount
                  </h3>
                  <p
                    class="text-sm text-gray-500 dark:text-dark-text-secondary"
                  >
                    Specify the amount you want to deposit (min. $100)
                  </p>
                </div>
              </div>
              <div class="flex items-start">
                <div
                  class="flex-shrink-0 w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center text-blue-600"
                >
                  3
                </div>
                <div class="ml-4">
                  <h3
                    class="text-sm font-medium text-gray-900 dark:text-dark-text-primary"
                  >
                    Send Payment
                  </h3>
                  <p
                    class="text-sm text-gray-500 dark:text-dark-text-secondary"
                  >
                    Transfer the exact amount to the generated address
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Deposits -->
        <div class="bg-white dark:bg-dark-bg-secondary rounded-lg shadow">
          <div class="p-6">
            <h2
              class="text-lg font-semibold text-gray-900 dark:text-dark-text-primary mb-4"
            >
              Recent Deposits
            </h2>
            <div class="overflow-hidden">
              <table
                class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"
              >
                <thead class="hidden lg:table-header-group">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-text-secondary uppercase tracking-wider"
                    >
                      Date
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-text-secondary uppercase tracking-wider"
                    >
                      Currency
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-text-secondary uppercase tracking-wider"
                    >
                      Amount
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-text-secondary uppercase tracking-wider"
                    >
                      Status
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-text-secondary uppercase tracking-wider"
                    >
                      Transaction ID
                    </th>
                  </tr>
                </thead>
                <tbody
                  class="bg-white dark:bg-dark-bg-secondary divide-y divide-gray-200 dark:divide-gray-700"
                >
                  <tr
                    class="deposit-row cursor-pointer lg:cursor-default"
                    onclick="toggleDepositDetails(this)"
                  >
                    <td class="px-6 py-4 whitespace-nowrap lg:table-cell">
                      <div class="flex items-center">
                        <button
                          class="mr-3 text-gray-500 dark:text-dark-text-secondary lg:hidden"
                        >
                          <i class="fas fa-plus expand-icon"></i>
                        </button>
                        <div>
                          <div
                            class="text-sm font-medium text-gray-900 dark:text-dark-text-primary"
                          >
                            2024-02-20
                          </div>
                          <!-- Mobile Only Details -->
                          <div class="mobile-details hidden lg:hidden mt-4">
                            <div
                              class="grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-3 gap-4"
                            >
                              <div>
                                <div
                                  class="text-xs text-gray-500 dark:text-dark-text-secondary"
                                >
                                  Currency
                                </div>
                                <div
                                  class="text-sm text-gray-900 dark:text-dark-text-primary"
                                >
                                  Bitcoin (BTC)
                                </div>
                              </div>
                              <div>
                                <div
                                  class="text-xs text-gray-500 dark:text-dark-text-secondary"
                                >
                                  Amount
                                </div>
                                <div
                                  class="text-sm text-gray-900 dark:text-dark-text-primary"
                                >
                                  $5,000.00
                                </div>
                              </div>
                              <div>
                                <div
                                  class="text-xs text-gray-500 dark:text-dark-text-secondary"
                                >
                                  Status
                                </div>
                                <span
                                  class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400"
                                  >Completed</span
                                >
                              </div>
                              <div class="col-span-full">
                                <div
                                  class="text-xs text-gray-500 dark:text-dark-text-secondary"
                                >
                                  Transaction ID
                                </div>
                                <div
                                  class="text-sm text-gray-900 dark:text-dark-text-primary truncate"
                                >
                                  0x1234...5678
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap hidden lg:table-cell"
                    >
                      <div
                        class="text-sm text-gray-900 dark:text-dark-text-primary"
                      >
                        Bitcoin (BTC)
                      </div>
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap hidden lg:table-cell"
                    >
                      <div
                        class="text-sm text-gray-900 dark:text-dark-text-primary"
                      >
                        $5,000.00
                      </div>
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap hidden lg:table-cell"
                    >
                      <span
                        class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-400"
                        >Completed</span
                      >
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap hidden lg:table-cell"
                    >
                      <div
                        class="text-sm text-gray-900 dark:text-dark-text-primary"
                      >
                        0x1234...5678
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Deposit Modal -->
    <div
      id="depositModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden z-50"
    >
      <div class="min-h-screen px-4 text-center">
        <div
          class="sm:inline-block align-bottom bg-white dark:bg-dark-bg-secondary rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
        >
          <!-- Step 1: Payment Details -->
          <div
            id="paymentStep"
            class="bg-white dark:bg-dark-bg-secondary px-4 pt-5 pb-4 sm:p-6 sm:pb-4"
          >
            <div class="sm:flex sm:items-start">
              <div class="w-full">
                <h3
                  class="text-lg leading-6 font-medium text-gray-900 dark:text-dark-text-primary mb-4"
                >
                  Complete Your Deposit
                </h3>

                <!-- Amount Display -->
                <div
                  class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4"
                >
                  <div class="flex flex-col space-y-2">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center">
                        <i class="fas fa-dollar-sign text-blue-600 mr-2"></i>
                        <span
                          class="text-blue-700 dark:text-blue-400 text-sm sm:text-base"
                          >USD Amount:</span
                        >
                      </div>
                      <span
                        id="usdAmountDisplay"
                        class="text-blue-700 dark:text-blue-400 font-bold text-sm sm:text-base"
                      ></span>
                    </div>
                    <div class="flex items-center justify-between">
                      <div class="flex items-center">
                        <i class="fas fa-coins text-blue-600 mr-2"></i>
                        <span
                          class="text-blue-700 dark:text-blue-400 text-sm sm:text-base"
                          >Crypto Amount:</span
                        >
                      </div>
                      <span
                        id="cryptoAmountDisplay"
                        class="text-blue-700 dark:text-blue-400 font-bold text-sm sm:text-base break-all"
                      ></span>
                    </div>
                  </div>
                </div>

                <div
                  class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4"
                >
                  <div class="flex items-center">
                    <i class="fas fa-clock text-yellow-600 mr-2"></i>
                    <span class="text-yellow-700 dark:text-yellow-400"
                      >Time remaining:
                      <span id="countdown" class="font-bold">10:00</span></span
                    >
                  </div>
                </div>

                <!-- QR Code -->
                <div class="flex justify-center mb-4">
                  <div
                    id="qrcode"
                    class="p-2 bg-white dark:bg-dark-bg-primary border rounded-lg"
                  ></div>
                </div>

                <!-- Wallet Address -->
                <div class="mb-4">
                  <label
                    class="block text-sm font-medium text-gray-700 dark:text-dark-text-primary mb-2"
                    >Wallet Address</label
                  >
                  <div class="flex">
                    <input
                      type="text"
                      id="walletAddress"
                      readonly
                      class="flex-1 block w-full px-3 py-2 sm:text-sm border border-gray-300 dark:border-gray-600 rounded-l-md bg-gray-50 dark:bg-dark-bg-primary dark:text-dark-text-primary"
                      value=""
                    />
                    <button
                      onclick="copyWalletAddress()"
                      class="inline-flex items-center px-4 py-2 border border-l-0 border-gray-300 dark:border-gray-600 rounded-r-md bg-gray-50 dark:bg-dark-bg-primary hover:bg-gray-100 dark:hover:bg-dark-bg-secondary"
                    >
                      <i
                        class="fas fa-copy text-gray-600 dark:text-dark-text-primary"
                      ></i>
                    </button>
                  </div>
                </div>

                <div class="flex flex-col space-y-3">
                  <button
                    onclick="showConfirmationStep()"
                    class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:text-sm"
                  >
                    I Have Made the Deposit
                  </button>
                  <button
                    onclick="cancelDeposit()"
                    class="w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-dark-bg-primary text-base font-medium text-gray-700 dark:text-dark-text-primary hover:bg-gray-50 dark:hover:bg-dark-bg-secondary focus:outline-none sm:text-sm"
                  >
                    Cancel Transaction
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Step 2: Confirmation -->
          <div
            id="confirmationStep"
            class="bg-white dark:bg-dark-bg-secondary px-4 pt-5 pb-4 sm:p-6 sm:pb-4 hidden"
          >
            <div class="sm:flex sm:items-start">
              <div class="w-full">
                <h3
                  class="text-lg leading-6 font-medium text-gray-900 dark:text-dark-text-primary mb-4"
                >
                  Confirm Your Deposit
                </h3>

                <!-- Transaction Screenshot Upload -->
                <div class="mb-4">
                  <label
                    class="block text-sm font-medium text-gray-700 dark:text-dark-text-primary mb-2"
                    >Upload Transaction Screenshot</label
                  >
                  <div
                    class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-md"
                  >
                    <div class="space-y-1 text-center">
                      <div
                        class="flex text-sm text-gray-600 dark:text-dark-text-secondary"
                      >
                        <label
                          for="transaction-image"
                          class="relative cursor-pointer bg-white dark:bg-dark-bg-primary rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none"
                        >
                          <span>Upload a file</span>
                          <input
                            id="transaction-image"
                            name="transaction-image"
                            type="file"
                            class="sr-only"
                            accept="image/*"
                          />
                        </label>
                      </div>
                      <p
                        class="text-xs text-gray-500 dark:text-dark-text-secondary"
                      >
                        PNG, JPG, GIF up to 10MB
                      </p>
                    </div>
                  </div>
                  <!-- Preview Image -->
                  <div id="imagePreview" class="mt-4 hidden">
                    <img
                      id="previewImg"
                      src=""
                      alt="Preview"
                      class="max-w-full h-auto rounded-lg"
                    />
                  </div>
                </div>

                <div class="flex flex-col space-y-3">
                  <button
                    onclick="submitDeposit()"
                    class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none sm:text-sm"
                  >
                    Submit
                  </button>
                  <button
                    onclick="backToPayment()"
                    class="w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-dark-bg-primary text-base font-medium text-gray-700 dark:text-dark-text-primary hover:bg-gray-50 dark:hover:bg-dark-bg-secondary focus:outline-none sm:text-sm"
                  >
                    Back
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Mobile menu functionality
      const menuBtn = document.getElementById("menuBtn");
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("overlay");

      function toggleSidebar() {
        sidebar.classList.toggle("-translate-x-full");
        overlay.classList.toggle("hidden");
        document.body.classList.toggle("overflow-hidden");
      }

      menuBtn.addEventListener("click", toggleSidebar);
      overlay.addEventListener("click", toggleSidebar);

      // Mobile table functionality
      function toggleDepositDetails(row) {
        if (window.innerWidth >= 1024) return;

        const mobileDetails = row.querySelector(".mobile-details");
        const expandIcon = row.querySelector(".expand-icon");

        mobileDetails.classList.toggle("hidden");
        expandIcon.classList.toggle("fa-plus");
        expandIcon.classList.toggle("fa-minus");
      }

      // Crypto conversion functionality
      let cryptoRates = {};
      const cryptoSymbols = {
        btc: "BTC",
        eth: "ETH",
        usdt: "USDT",
        bnb: "BNB",
      };

      // Function to fetch current crypto rates
      async function fetchCryptoRates() {
        try {
          const response = await fetch(
            "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,tether,binance-coin&vs_currencies=usd"
          );
          const data = await response.json();

          cryptoRates = {
            btc: 1 / data.bitcoin.usd,
            eth: 1 / data.ethereum.usd,
            usdt: 1 / data.tether.usd,
            bnb: 1 / data["binance-coin"].usd,
          };
        } catch (error) {
          console.error("Error fetching crypto rates:", error);
          cryptoRates = {
            btc: 1 / 65000,
            eth: 1 / 3500,
            usdt: 1,
            bnb: 1 / 450,
          };
        }
      }

      // Function to update crypto amount
      function updateCryptoAmount() {
        const usdAmount = document.getElementById("usdAmount").value;
        const cryptoSelect = document.querySelector("select");
        const selectedCrypto = cryptoSelect.value;
        const cryptoAmount = document.getElementById("cryptoAmount");
        const cryptoSymbolElement = document.getElementById("cryptoSymbol");

        if (usdAmount && usdAmount >= 100 && cryptoRates[selectedCrypto]) {
          const convertedAmount = usdAmount * cryptoRates[selectedCrypto];
          cryptoAmount.value = convertedAmount.toFixed(8);
          cryptoSymbolElement.textContent = cryptoSymbols[selectedCrypto];
        } else {
          cryptoAmount.value = "";
          cryptoSymbolElement.textContent = "";
        }
      }

      // Modal functionality
      let countdownInterval;
      let qrCode = null;

      function startCountdown() {
        let timeLeft = 10 * 60; // 10 minutes in seconds
        const countdownEl = document.getElementById("countdown");

        if (countdownInterval) {
          clearInterval(countdownInterval);
        }

        countdownInterval = setInterval(() => {
          const minutes = Math.floor(timeLeft / 60);
          const seconds = timeLeft % 60;
          countdownEl.textContent = `${minutes
            .toString()
            .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;

          if (timeLeft <= 0) {
            clearInterval(countdownInterval);
            cancelDeposit();
            return;
          }
          timeLeft--;
        }, 1000);
      }

      function showDepositModal(walletAddress, amount, crypto) {
        // Clear any existing QR code
        const qrcodeDiv = document.getElementById("qrcode");
        qrcodeDiv.innerHTML = "";

        document.getElementById("depositModal").classList.remove("hidden");
        document.getElementById("paymentStep").classList.remove("hidden");
        document.getElementById("confirmationStep").classList.add("hidden");
        document.getElementById("walletAddress").value = walletAddress;

        // Update the split display of USD and crypto amounts
        const cryptoAmount = document.getElementById("cryptoAmount").value;
        const cryptoSymbol =
          document.getElementById("cryptoSymbol").textContent;
        document.getElementById("usdAmountDisplay").textContent = amount;
        document.getElementById(
          "cryptoAmountDisplay"
        ).textContent = `${cryptoAmount} ${cryptoSymbol}`;

        // Generate QR Code
        qrCode = new QRCode(qrcodeDiv, {
          text: walletAddress,
          width: 128,
          height: 128,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H,
        });

        // Start countdown
        startCountdown();
      }

      function copyWalletAddress() {
        const walletAddress = document.getElementById("walletAddress");
        walletAddress.select();
        document.execCommand("copy");
        alert("Wallet address copied!");
      }

      function showConfirmationStep() {
        document.getElementById("paymentStep").classList.add("hidden");
        document.getElementById("confirmationStep").classList.remove("hidden");
        if (countdownInterval) {
          clearInterval(countdownInterval);
        }
      }

      function backToPayment() {
        document.getElementById("paymentStep").classList.remove("hidden");
        document.getElementById("confirmationStep").classList.add("hidden");
        startCountdown();
      }

      function cancelDeposit() {
        if (countdownInterval) {
          clearInterval(countdownInterval);
        }
        document.getElementById("depositModal").classList.add("hidden");
        document.getElementById("transaction-image").value = "";
        document.getElementById("imagePreview").classList.add("hidden");

        // Clear QR code
        if (qrCode) {
          document.getElementById("qrcode").innerHTML = "";
          qrCode = null;
        }
      }

      function submitDeposit() {
        // Here you would typically send the data to your server
        cancelDeposit();
      }

      // Initialize everything when the DOM is loaded
      document.addEventListener("DOMContentLoaded", async function () {
        await fetchCryptoRates();
        setInterval(fetchCryptoRates, 60000);

        // Add event listeners for amount and currency changes
        document
          .getElementById("usdAmount")
          .addEventListener("input", updateCryptoAmount);
        document
          .querySelector("select")
          .addEventListener("change", updateCryptoAmount);

        // Image preview functionality
        document
          .getElementById("transaction-image")
          .addEventListener("change", function (e) {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = function (e) {
                const previewImg = document.getElementById("previewImg");
                previewImg.src = e.target.result;
                document
                  .getElementById("imagePreview")
                  .classList.remove("hidden");
              };
              reader.readAsDataURL(file);
            }
          });

        // Generate wallet address button click handler
        document
          .querySelector("button.bg-blue-600")
          .addEventListener("click", function () {
            const cryptoSelect = document.querySelector("select");
            const amountInput = document.getElementById("usdAmount");

            if (!amountInput.value || amountInput.value < 100) {
              alert("Please enter an amount greater than or equal to $100");
              return;
            }

            const demoWallets = {
              btc: "1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa",
              eth: "0x742d35Cc6634C0532925a3b844Bc454e4438f44e",
              usdt: "TKFLguL3uHxe3sZvxPgHCjK5YftvuXsXE5",
              bnb: "bnb1jxfh2g85q3v0tdq56fnevx6xcxtcnhtsmcu64m",
            };

            const selectedCrypto = cryptoSelect.value;
            const cryptoName =
              cryptoSelect.options[cryptoSelect.selectedIndex].text;
            const walletAddress = demoWallets[selectedCrypto];
            const amount = parseFloat(amountInput.value).toLocaleString(
              "en-US",
              {
                style: "currency",
                currency: "USD",
              }
            );

            showDepositModal(walletAddress, amount, cryptoName);
          });
      });

      // Add dark mode functionality
      const darkModeToggle = document.getElementById("darkModeToggle");
      const darkModeToggleMobile = document.getElementById(
        "darkModeToggleMobile"
      );
      const html = document.documentElement;

      // Check for saved dark mode preference
      if (
        localStorage.getItem("darkMode") === "enabled" ||
        (!localStorage.getItem("darkMode") &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        html.classList.add("dark");
      }

      // Toggle dark mode function
      function toggleDarkMode() {
        html.classList.toggle("dark");
        localStorage.setItem(
          "darkMode",
          html.classList.contains("dark") ? "enabled" : "disabled"
        );
      }

      // Add click handlers to both toggle buttons
      darkModeToggle.addEventListener("click", toggleDarkMode);
      darkModeToggleMobile.addEventListener("click", toggleDarkMode);

      // Watch for system theme changes
      window
        .matchMedia("(prefers-color-scheme: dark)")
        .addEventListener("change", (e) => {
          if (!localStorage.getItem("darkMode")) {
            html.classList.toggle("dark", e.matches);
          }
        });
    </script>

    <!-- Add this before the closing body tag -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  </body>
</html>
